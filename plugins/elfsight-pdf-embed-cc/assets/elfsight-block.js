/*
    Elfsight PDF Embed
    Version: 1.0.1
    Release date: Thu Aug 15 2019

    https://elfsight.com

    Copyright (c) 2019 Elfsight, LLC. ALL RIGHTS RESERVED
*/

!function(wp,$){"use strict";let IconBlock=function(e){return wp.element.createElement("svg",{width:"20",height:"20",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",class:"dashicon"},[wp.element.createElement("path",{d:"M3.729 1.972v16.056c0 .156.129.282.288.282h12.966c.16 0 .288-.126.288-.282V5.542a.28.28 0 0 0-.28-.279l-3.18.016a.558.558 0 0 1-.562-.558V1.969a.28.28 0 0 0-.28-.279H4.018a.285.285 0 0 0-.288.282zM13.249 0c.757 0 1.488.265 2.063.746l2.581 2.163A3.07 3.07 0 0 1 19 5.262v12.766c0 1.09-.903 1.972-2.017 1.972H4.017C2.903 20 2 19.117 2 18.028V1.972C2 .882 2.903 0 4.017 0h9.232zm-5.22 9.533c.092.19.137.401.137.634 0 .233-.045.443-.137.631-.092.188-.21.338-.354.449-.293.23-.596.344-.91.344h-.66v.607c0 .082-.003.144-.008.185a.435.435 0 0 1-.05.143c-.05.096-.187.145-.412.145-.247 0-.392-.067-.434-.2a.912.912 0 0 1-.032-.279V9.211c0-.083.003-.145.008-.186a.435.435 0 0 1 .05-.142c.05-.097.187-.145.413-.145H6.77c.31 0 .611.114.904.344.144.11.262.261.354.45zM6.77 10.64c.106 0 .21-.04.312-.118.102-.08.153-.197.153-.355 0-.158-.051-.277-.153-.357a.507.507 0 0 0-.317-.121h-.661v.95h.666zm2.497-1.908l.978.006c.511 0 .96.187 1.348.561.388.375.581.835.581 1.381s-.189 1.015-.568 1.405c-.379.39-.837.586-1.377.586h-.967c-.215 0-.349-.045-.402-.135-.042-.075-.063-.19-.063-.344V9.205c0-.086.003-.148.008-.188a.438.438 0 0 1 .05-.14c.05-.096.187-.145.412-.145zm.978 2.988a.98.98 0 0 0 .687-.288.949.949 0 0 0 .307-.722c0-.29-.1-.533-.299-.728a.968.968 0 0 0-.7-.293h-.507v2.03h.512zm5.125-2.982c.08 0 .141.002.182.008.04.005.086.022.137.05a.238.238 0 0 1 .109.146c.02.068.031.16.031.274 0 .115-.01.206-.031.274a.225.225 0 0 1-.111.142.448.448 0 0 1-.14.049c-.04.005-.103.008-.188.008h-1.617v.542h1.04c.085 0 .148.003.189.008.04.006.087.023.14.051.091.054.137.196.137.425 0 .25-.067.4-.2.446a.973.973 0 0 1-.27.027h-1.036v1.015c0 .086-.003.149-.008.188a.438.438 0 0 1-.05.14c-.05.097-.187.145-.413.145-.246 0-.39-.068-.433-.204a.858.858 0 0 1-.032-.274V9.21c0-.183.034-.308.1-.374.068-.066.194-.1.381-.1h2.083z",id:"a"})])};if(void 0===wp.components||void 0===wp.blocks||void 0===wp.element||void 0===wp.i18n)return!1;const{__:__}=wp.i18n,el=wp.element.createElement,registerBlockType=wp.blocks.registerBlockType,ServerSideRender=wp.components.ServerSideRender;let initTimeout;function initWidget(){clearTimeout(initTimeout),initTimeout=setTimeout(function(){let widgets=document.querySelectorAll("[data-elfsight-pdf-embed-options]");Array.prototype.slice.call(widgets).forEach(function(widget){let options=widget.getAttribute("data-elfsight-pdf-embed-options"),data=JSON.parse(decodeURIComponent(options));eval("eappsPdfEmbed(widget, data)"),widget.removeAttribute("data-elfsight-pdf-embed-options"),widget.removeAttribute("data-elfsight-pdf-embed-version"),widget.closest(".elfsight-block-widget-container").classList.add("elfsight-block-widget-initialized")})},1500)}async function getWidgets(){const e=await $.get(ajaxurl,{action:"elfsight-pdf-embed".replace(/-/g,"_")+"_widgets_api",endpoint:"list"});return e.status?[e.data,e.data.reduce(function(e,t){return e[t.id]=t,e},{})]:[]}function getWidgetId(e){let t;return e.some(function(e){if("1"===e.active)return t=e.id}),t}class Widget extends React.Component{componentDidMount(){initWidget()}componentDidUpdate(){initWidget()}render(){return this.props.id?el("div",{className:"elfsight-block-widget-container"},el(ServerSideRender,{block:"elfsight-pdf-embed/block",attributes:{id:this.props.id||"1"}}),el("div",{className:"elfsight-block-widget-placeholder"},el(IconBlock,{}),el("span",{},"Elfsight PDF Embed"))):[]}}class Button extends React.Component{render(){let e=document.location.origin+document.location.pathname.replace("post.php","admin.php")+"?page=elfsight-pdf-embed#";return el("a",{href:e+this.props.href,target:"_blank",className:this.props.className},this.props.text)}}class WidgetSelect extends React.Component{constructor(){super(),this.state={widgets:[]}}setWidget(e){e.preventDefault();let t=e.target.querySelector("option:checked");this.props.setAttributes({id:t.value.toString()})}componentDidMount(){getWidgets().then(e=>{const[t,i]=e;this.setState({widgets:t});const s=this.props.id,o=!(!i[s]||"1"!==i[s].active);!o&&i?this.props.setAttributes({id:getWidgetId(t),exist:!0}):this.props.setAttributes({id:s,exist:o})})}render(){return this.state.widgets.length>0?el("div",{className:"components-base-control"},el("div",{className:"components-base-control__field"},el("select",{className:"components-select-control__input",id:"elfsight-pdf-embed-block-control-id",value:this.props.id,onChange:this.setWidget.bind(this)},this.state.widgets.map(e=>wp.element.createElement("option",{value:e.id},[e.name]))))):[]}}registerBlockType("elfsight-pdf-embed/block",{title:"Elfsight PDF Embed",description:"An easy tool for integrating PDF docs in your web page with view and download available.",icon:{src:IconBlock},category:"widgets",keywords:["Elfsight PDF Embed","Elfsight"],supports:{html:!1},attributes:{id:{type:"number"},exist:{type:"bool",default:!1}},edit:function(e){const{attributes:{id:t,exist:i},setAttributes:s}=e;return getWidgets().then(e=>{const[o,n]=e;s(!i&&o?{id:getWidgetId(o),exist:!0}:{id:t,exist:i})}),el(wp.element.Fragment,{},el(wp.editor.InspectorControls,{},el(wp.components.PanelBody,{className:"elfsight-block-panel",title:"Select widget"},el(WidgetSelect,{id:t,setAttributes:function(t){e.setAttributes(t)}}),i?el("div",{className:"elfsight-block-panel-group"},el(Button,{href:"/edit-widget/"+t,className:"components-button is-button is-default is-large elfsight-block-panel-button",text:__("Edit Widget")}),el(Button,{href:"/add-widget/",className:"elfsight-block-panel-link",text:__("Create new widget")})):el("div",{className:"elfsight-block-panel-group"},el("span",{},__("No widgets yet")),el(Button,{href:"/add-widget/",className:"components-button is-button is-default is-primary is-large elfsight-block-panel-button",text:__("Create Widget")})))),i?el(Widget,{id:t,exist:i}):null,i?null:el("div",{className:"elfsight-block-form"},el("div",{className:"elfsight-block-form-header"},el(IconBlock,{}),el("span",{},"Elfsight PDF Embed")),el("div",{className:"elfsight-block-form-text"},__("An easy tool for integrating PDF docs in your web page with view and download available."),el("br"),el("strong",{},__("Let's create your first widget!"))),el(Button,{href:"/add-widget/",className:"components-button is-button is-default is-primary is-large elfsight-block-form-button",text:__("Create Widget")})))},save:function(){return null}})}(wp,jQuery);